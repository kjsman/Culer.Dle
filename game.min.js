unit=60,zboard=.7*-unit,movetick=0,count=0,spinSpeed=10;let illo=new Zdog.Illustration({element:".zdog-canvas",dragRotate:!0});function c(e){return(e-1.5)*unit}function f(e){return e?"#E62":"#FFF"}function createCheckBoard(){for(boardGroup=new Zdog.Group({addTo:illo,translate:{z:zboard}}),x=0;x<4;x++)for(y=0;y<4;y++)board[x][y]=new Zdog.Rect({addTo:boardGroup,width:unit,height:unit,translate:{x:c(x),y:c(y)},stroke:10,color:"#E62"});new Zdog.Shape({addTo:boardGroup,visible:!1,translate:{z:-9999}}),new Zdog.Shape({addTo:boardGroup,path:[{x:c(4.5),y:c(-1)},{x:c(3.5),y:c(-1)},{x:c(4),y:c(-1.5)},{x:c(4),y:c(-.5)}],closed:!1,stroke:10,color:"#636"})}function createCube(){bcube=new Zdog.Box({addTo:illo,width:.99*unit,height:.99*unit,depth:.99*unit,translate:{x:c(0),y:c(0),z:zboard+unit/2},frontFace:f(cube.front),rearFace:f(cube.rear),leftFace:f(cube.left),rightFace:f(cube.right),topFace:f(cube.top),bottomFace:f(cube.bottom)})}function generateRandom(){for(i=6;i;)x=parseInt(4*Math.random()),y=parseInt(4*Math.random()),0==map[x][y]&&(map[x][y]=1,i--);for(;0==i;)x=parseInt(4*Math.random()),y=parseInt(4*Math.random()),0==map[x][y]&&(cube.x=x,cube.y=y,i=1)}function syncAll(){for(x=0;x<4;x++)for(y=0;y<4;y++)board[x][y].fill=1==map[x][y];bcube.translate.x=c(cube.x),bcube.translate.y=c(cube.y),bcube.frontFace=f(cube.front),bcube.rearFace=f(cube.rear),bcube.leftFace=f(cube.left),bcube.rightFace=f(cube.right),bcube.topFace=f(cube.top),bcube.bottomFace=f(cube.bottom)}function continueMove(){bcube.translate.x=c(cube.x+cube.dx*movetick/spinSpeed),bcube.translate.y=c(cube.y+cube.dy*movetick/spinSpeed),bcube.translate.z=zboard+unit/2+(Math.sin(Zdog.TAU/8+Zdog.TAU/4*movetick/spinSpeed)-Math.sin(Zdog.TAU/8))*unit/Math.sqrt(2),bcube.rotate.y=-cube.dx*movetick/spinSpeed*Zdog.TAU/4,bcube.rotate.x=-cube.dy*movetick/spinSpeed*Zdog.TAU/4,movetick++,movetick==spinSpeed&&(cube.x+=cube.dx,cube.y+=cube.dy,1==cube.dx?[cube.front,cube.right,cube.rear,cube.left]=[cube.left,cube.front,cube.right,cube.rear]:-1==cube.dx?[cube.front,cube.right,cube.rear,cube.left]=[cube.right,cube.rear,cube.left,cube.front]:1==cube.dy?[cube.front,cube.top,cube.rear,cube.bottom]=[cube.top,cube.rear,cube.bottom,cube.front]:-1==cube.dy&&([cube.front,cube.top,cube.rear,cube.bottom]=[cube.bottom,cube.front,cube.top,cube.rear]),cube.dx=0,cube.dy=0,bcube.translate.z=zboard+unit/2,bcube.rotate.x=0,bcube.rotate.y=0,tmp=cube.rear,cube.rear=map[cube.x][cube.y],map[cube.x][cube.y]=tmp,movetick=0,cube.front*cube.rear*cube.left*cube.right*cube.top*cube.bottom&&(count<=50?msg=`와! ${count}번만에`:count>=150?msg=`${count}번이나 걸려서`:msg=`${count}번에`,alert(`${msg} 깨셨습니다. 축하합니다!\n\n지금 캡쳐하세요. 이 메시지 닫자마자 새로고침될거임`),location.reload()))}function init(){createCheckBoard(),generateRandom(),createCube()}function animate(){movetick&&continueMove(),0==movetick&&syncAll(),illo.updateRenderGraph(),requestAnimationFrame(animate)}function move(e,t){movetick||(x=cube.x+e,y=cube.y+t,x<0||x>3||y<0||y>3||(count++,document.getElementById("count").innerText=count,cube.dx=e,cube.dy=t,movetick=1))}map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],cube={x:0,y:0,dx:0,dy:0,front:0,rear:0,left:0,right:0,top:0,bottom:0},bcube=null,board=[...new Array(4)].map(e=>new Array(4)),moveUp=(()=>move(0,-1)),moveDown=(()=>move(0,1)),moveRight=(()=>move(1,0)),moveLeft=(()=>move(-1,0)),window.addEventListener("keydown",function(e){const t={ArrowUp:moveUp,ArrowDown:moveDown,ArrowRight:moveRight,ArrowLeft:moveLeft,KeyW:moveUp,KeyS:moveDown,KeyD:moveRight,KeyA:moveLeft}[e.code];null==t||t()}),init(),animate();